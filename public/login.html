<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Login</title>
  </head>

  <body>
    <button id="login">Login with Discord</button>
    <div id="status"></div>

    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js";

      const supabase = createClient(
        "https://msgozdhtfawuadxerkxq.supabase.co",
        "sb_publishable_wnNxDxsZA_SazdahnpMiIg__zR2QQvv",
        {
          auth: {
            flowType: "pkce",
            detectSessionInUrl: true,
          },
        }
      );

      async function checkAuth() {
        const {
          data: { user },
        } = await supabase.auth.getUser();

        const statusEl = document.getElementById("status");
        const loginBtn = document.getElementById("login");

        if (user) {
          statusEl.textContent = `Logged in as ${
            user.email ??
            user.user_metadata?.full_name ??
            "Discord user"
          }`;
          loginBtn.style.display = "none";
        } else {
          statusEl.textContent = "Not logged in.";
          loginBtn.style.display = "";
        }
      }

      document.getElementById("login").addEventListener("click", async () => {
        await supabase.auth.signInWithOAuth({
          provider: "discord",
          options: {
            redirectTo: `${window.location.origin}/auth/callback`,
          },
        });
      });

      window.addEventListener("DOMContentLoaded", () => {
        checkAuth();
      });
    </script>
  </body>
</html>